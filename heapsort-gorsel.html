<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Heap Sort Heapify Görselleştirme</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  </head>
  <body>
    <script>
      let values = [];
      let heapSteps = [];
      let currentStep = 0;
      let n = 10;

      function setup() {
        createCanvas(600, 400);
        frameRate(1);
        for (let i = 0; i < n; i++) {
          values.push(floor(random(10, 100)));
        }
        generateHeapSteps([...values]);
      }

      function draw() {
        background(240);
        textSize(16);
        fill(0);
        text("Heapify Adım: " + currentStep, 20, 30);
        if (currentStep < heapSteps.length) {
          drawArray(heapSteps[currentStep]);
          currentStep++;
        } else {
          text("Heap tamamlandı!", 20, height - 20);
          noLoop();
        }
      }

      function drawArray(arr) {
        let barWidth = width / arr.length;
        for (let i = 0; i < arr.length; i++) {
          fill(100, 150, 255);
          rect(i * barWidth, height - arr[i] * 3, barWidth - 4, arr[i] * 3);
          fill(0);
          textAlign(CENTER);
          text(arr[i], i * barWidth + barWidth / 2, height - arr[i] * 3 - 5);
        }
      }

      function heapify(arr, n, i, steps) {
        let largest = i;
        let left = 2 * i + 1;
        let right = 2 * i + 2;
        if (left < n && arr[left] > arr[largest]) largest = left;
        if (right < n && arr[right] > arr[largest]) largest = right;
        if (largest !== i) {
          [arr[i], arr[largest]] = [arr[largest], arr[i]];
          steps.push([...arr]);
          heapify(arr, n, largest, steps);
        }
      }

      function generateHeapSteps(arr) {
        let steps = [];
        let n = arr.length;
        for (let i = floor(n / 2) - 1; i >= 0; i--) {
          heapify(arr, n, i, steps);
        }
        heapSteps = steps;
      }
    </script>
  </body>
</html>
